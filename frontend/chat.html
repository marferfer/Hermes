<!DOCTYPE html>

<html class="light" lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Hermes - Corporate Knowledge Chat</title>
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<!-- Theme Configuration -->
<script id="tailwind-config">
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              "primary": "#4b91e2",
              "primary-dark": "#3a7bc0",
              "background-light": "#f6f7f8",
              "background-dark": "#121820",
              "surface-light": "#ffffff",
              "surface-dark": "#1e293b",
            },
            fontFamily: {
              "display": ["Inter", "sans-serif"]
            },
            borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
          },
        },
      }
    </script>
<style>
        /* Custom scrollbar for webkit */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        /* Hide scrollbar for clean UI but keep functionality */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-white overflow-hidden h-screen flex w-full">
<div id="sidebar"></div>
<!-- Main Content Area -->
<main class="flex-1 flex flex-col min-w-0 relative bg-background-light dark:bg-background-dark">
<!-- Chat Header -->
<header class="h-16 bg-white dark:bg-surface-dark border-b border-slate-200 dark:border-slate-700 flex items-center justify-between px-6 shrink-0 z-10 shadow-sm">
<div>
<h1 class="text-lg font-semibold text-slate-900 dark:text-white">Chat de Conocimiento</h1>
<p class="text-xs text-slate-500">Conectado a la base de datos de RRHH</p>
</div>
<div class="flex items-center gap-2">
<button class="p-2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">
<span class="material-symbols-outlined">search</span>
</button>
<button class="p-2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors">
<span class="material-symbols-outlined">more_vert</span>
</button>
</div>
</header>
<!-- Chat History -->
<div class="flex-1 overflow-y-auto p-4 md:p-8 space-y-8 scroll-smooth" id="chat-container">
<!-- System Welcome Message -->
<div class="flex items-start gap-4 max-w-3xl">
<div class="bg-gradient-to-br from-primary to-blue-600 rounded-full size-10 flex items-center justify-center shrink-0 shadow-sm text-white">
<span class="material-symbols-outlined text-xl">smart_toy</span>
</div>
<div class="flex flex-col gap-1">
<div class="flex items-baseline gap-2">
<span class="text-sm font-semibold text-slate-900 dark:text-white">Hermes</span>
<span class="text-xs text-slate-500">10:00 AM</span>
</div>
<div class="p-4 bg-white dark:bg-surface-dark border border-slate-200 dark:border-slate-700 rounded-2xl rounded-tl-none shadow-sm text-slate-700 dark:text-slate-200 text-[15px] leading-relaxed">
<p>Hola Ana. Soy Hermes, tu asistente de conocimiento corporativo. Tengo acceso completo a los archivos actualizados de Recursos Humanos. ¬øQu√© necesitas consultar hoy?</p>
</div>
</div>
</div>
<!-- User Message -->
<div class="flex items-start gap-4 max-w-3xl ml-auto flex-row-reverse">
<div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 shrink-0 ring-2 ring-white shadow-sm" data-alt="User avatar" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuBE5ypuuVVWtjF8DS-IKYeHH2-ulpRTnzyIhUXRGgI9X30dsdjRgt2ctqcYmSyqHiFB7t8pagzdeQ-kn4L8ZyLTDi1FX7p8yVIf3QtI5HGwdCeBXV7gJQ7ISKLZ-I8tQs419VFkoYT3c38NSSTrf2vTKC92mNHwukBy7gd7zEQKOLUBPTM_MtXDr5UkVm6n63gnQeqVbRUWED_7ND3IlD_Zr47vIbm_vHJH1PAVL5v6KmZH3gQ6cdZaEXFP1IbVTtEKVYXt-zrtVUAf");'>
</div>
<div class="flex flex-col gap-1 items-end">
<div class="flex items-baseline gap-2 flex-row-reverse">
<span class="text-sm font-semibold text-slate-900 dark:text-white">Ana Garc√≠a</span>
<span class="text-xs text-slate-500">10:05 AM</span>
</div>
<div class="p-4 bg-primary text-white rounded-2xl rounded-tr-none shadow-md text-[15px] leading-relaxed">
<p>¬øCu√°l es la pol√≠tica de vacaciones para nuevos empleados?</p>
</div>
</div>
</div>
<!-- System Response with Sources -->
<div class="flex items-start gap-4 max-w-3xl w-full">
<div class="bg-gradient-to-br from-primary to-blue-600 rounded-full size-10 flex items-center justify-center shrink-0 shadow-sm text-white">
<span class="material-symbols-outlined text-xl">smart_toy</span>
</div>
<div class="flex flex-col gap-1 w-full max-w-2xl">
<div class="flex items-baseline gap-2">
<span class="text-sm font-semibold text-slate-900 dark:text-white">Hermes</span>
<span class="text-xs text-slate-500">10:05 AM</span>
</div>
<div class="p-4 bg-white dark:bg-surface-dark border border-slate-200 dark:border-slate-700 rounded-2xl rounded-tl-none shadow-sm text-slate-700 dark:text-slate-200 text-[15px] leading-relaxed">
<p class="mb-3">Seg√∫n la pol√≠tica vigente, los nuevos empleados acumulan <strong>1.25 d√≠as por mes trabajado</strong> durante el primer a√±o. Esto equivale a 15 d√≠as h√°biles anuales.</p>
<p>Es importante notar que el derecho a goce se activa despu√©s de completar el periodo de prueba de 3 meses.</p>
<!-- Sources Expander -->
<div class="mt-4 pt-3 border-t border-slate-100 dark:border-slate-700">
<details class="group" open="">
<summary class="flex items-center cursor-pointer list-none select-none text-xs font-semibold text-slate-500 uppercase tracking-wide hover:text-primary transition-colors mb-3">
<div class="flex items-center gap-1">
<span class="material-symbols-outlined text-[18px]">library_books</span>
                                        Fuentes consultadas (2)
                                    </div>
<span class="material-symbols-outlined ml-auto text-[18px] transform group-open:rotate-180 transition-transform">expand_more</span>
</summary>
<div class="space-y-2 animate-fadeIn">
<a class="flex items-center gap-3 p-2.5 rounded-lg border border-slate-100 dark:border-slate-700 hover:border-primary/30 hover:bg-slate-50 dark:hover:bg-slate-800 bg-slate-50/50 dark:bg-slate-800/50 transition-all group/doc" href="#">
<div class="size-8 rounded bg-red-50 dark:bg-red-900/20 flex items-center justify-center text-red-500 shrink-0">
<span class="material-symbols-outlined text-[20px]">picture_as_pdf</span>
</div>
<div class="flex flex-col overflow-hidden">
<span class="text-sm font-medium text-slate-700 dark:text-slate-200 truncate group-hover/doc:text-primary transition-colors">Manual_Empleado_2023.pdf</span>
<span class="text-[11px] text-slate-400">P√°gina 14 ‚Ä¢ Secci√≥n 4.2</span>
</div>
<span class="material-symbols-outlined ml-auto text-slate-300 text-[20px] group-hover/doc:text-primary">open_in_new</span>
</a>
<a class="flex items-center gap-3 p-2.5 rounded-lg border border-slate-100 dark:border-slate-700 hover:border-primary/30 hover:bg-slate-50 dark:hover:bg-slate-800 bg-slate-50/50 dark:bg-slate-800/50 transition-all group/doc" href="#">
<div class="size-8 rounded bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center text-blue-500 shrink-0">
<span class="material-symbols-outlined text-[20px]">article</span>
</div>
<div class="flex flex-col overflow-hidden">
<span class="text-sm font-medium text-slate-700 dark:text-slate-200 truncate group-hover/doc:text-primary transition-colors">Anexo_Vacaciones.docx</span>
<span class="text-[11px] text-slate-400">Tabla 2 ‚Ä¢ Acumulaci√≥n</span>
</div>
<span class="material-symbols-outlined ml-auto text-slate-300 text-[20px] group-hover/doc:text-primary">open_in_new</span>
</a>
</div>
</details>
</div>
</div>
</div>
</div>
<!-- Thinking Indicator (Simulated) -->
<!-- <div class="flex items-center gap-2 text-xs text-slate-400 ml-16 pl-2 animate-pulse">
                <span class="material-symbols-outlined text-[16px] animate-spin">sync</span>
                Generando respuesta...
             </div> -->
</div>
<!-- Input Area -->
<div class="bg-white dark:bg-surface-dark border-t border-slate-200 dark:border-slate-700 p-4 md:px-8 md:py-6 shrink-0 z-20">
<div class="max-w-4xl mx-auto relative">
<div class="relative flex items-end gap-2 bg-slate-100 dark:bg-slate-800 rounded-xl p-2 border border-transparent focus-within:border-primary/50 focus-within:ring-4 focus-within:ring-primary/10 transition-all shadow-inner">
<button class="p-2 text-slate-400 hover:text-primary rounded-lg hover:bg-white dark:hover:bg-slate-700 transition-colors shrink-0 mb-0.5" title="Adjuntar archivo">
<span class="material-symbols-outlined text-[24px]">attach_file</span>
</button>
<textarea class="w-full bg-transparent border-0 text-slate-900 dark:text-white placeholder-slate-400 focus:ring-0 py-3 px-2 resize-none max-h-32 text-[15px]" placeholder="Escribe tu pregunta sobre los documentos..." rows="1" style="min-height: 48px;"></textarea>
<button class="p-2.5 bg-primary hover:bg-primary-dark text-white rounded-lg shadow-sm transition-all hover:scale-105 active:scale-95 shrink-0 mb-0.5">
<span class="material-symbols-outlined text-[20px] translate-x-0.5">send</span>
</button>
</div>
<div class="text-center mt-2">
<p class="text-[11px] text-slate-400">Hermes puede cometer errores. Verifica la informaci√≥n importante en la <a class="underline hover:text-primary" href="library.html">Biblioteca</a>.</p>
</div>
</div>
</div>
</main>
<!-- Auth Scripts -->
<!-- <script>
  // ‚úÖ Solo en chat.html: funciones de perfil y logout
  function logout() {
    localStorage.removeItem('hermes_tokens');
    localStorage.removeItem('hermes_user');
    window.location.href = 'index.html';
  }

  function loadUserProfile() {
    try {
        const userRaw = localStorage.getItem('hermes_user');
        const tokensRaw = localStorage.getItem('hermes_tokens');
        
        // Validar que existan ambos datos
        if (!userRaw || !tokensRaw) {
            showLoginError("No hay sesi√≥n activa");
            return;
        }
        
        const user = JSON.parse(userRaw);
        const tokens = JSON.parse(tokensRaw);
        
        // Validar token y usuario
        if (!user.sub || !tokens.access_token) {
            localStorage.removeItem('hermes_tokens');
            localStorage.removeItem('hermes_user');
            showLoginError("Sesi√≥n corrupta");
            return;
        }
        
        // Extraer departamento de los roles
        const roles = user.realm_access?.roles || [];
        const validDepartments = ["[1014] Sistemas", "IT", "Finanzas", "RRHH", "Marketing", "Direcci√≥n"];
        const department = roles.find(role => validDepartments.includes(role)) || "IT";
        
        // Mostrar el chat real
        showChatInterface(user, department);
        
    } catch (e) {
        console.error("Error al cargar usuario:", e);
        localStorage.removeItem('hermes_tokens');
        localStorage.removeItem('hermes_user');
        showLoginError("Error al cargar la sesi√≥n");
    }
}

function showLoginError(message) {
    document.getElementById('chat-container').innerHTML = `
        <div class="flex items-center justify-center h-full">
            <div class="text-center p-8">
                <div class="text-4xl mb-4">üîí</div>
                <h2 class="text-xl font-semibold text-slate-900 dark:text-white">Sesi√≥n no v√°lida</h2>
                <p class="text-slate-500 mt-2">${message || "Por favor, inicia sesi√≥n de nuevo."}</p>
                <button onclick="window.location.href='index.html'" 
                        class="mt-4 px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-600">
                    Ir al login
                </button>
            </div>
        </div>
    `;
}

function showChatInterface(user, department) {
    // Actualizar el perfil en el sidebar
    const usernameElement = document.querySelector('h2.text-sm.font-semibold');
    const departmentElement = document.querySelector('.p-4 > div > div:nth-child(2) > p');
    const headerElement = document.querySelector('header p.text-xs.text-slate-500');
    
    if (usernameElement) {
        usernameElement.textContent = user.preferred_username || user.sub;
    }
    if (departmentElement) {
        departmentElement.textContent = department;
    }
    if (headerElement) {
        headerElement.textContent = `Conectado a la base de datos de ${department}`;
    }
    
    // Si ya hay mensajes de chat, no sobrescribas
    if (document.querySelector('#chat-container > :not(script)')) {
        return;
    }
    
    // Mostrar el chat inicial si no hay mensajes
    document.getElementById('chat-container').innerHTML = `
    <div class="flex items-start gap-4 max-w-3xl">
        <div class="bg-gradient-to-br from-primary to-blue-600 rounded-full size-10 flex items-center justify-center shrink-0 shadow-sm text-white">
            <span class="material-symbols-outlined text-xl">smart_toy</span>
        </div>
        <div class="flex flex-col gap-1">
            <div class="flex items-baseline gap-2">
                <span class="text-sm font-semibold text-slate-900 dark:text-white">Hermes</span>
                <span class="text-xs text-slate-500">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
            </div>
            <div class="p-4 bg-white dark:bg-surface-dark border border-slate-200 dark:border-slate-700 rounded-2xl rounded-tl-none shadow-sm text-slate-700 dark:text-slate-200 text-[15px] leading-relaxed">
                <p>Hola ${user.preferred_username || user.sub}. Soy Hermes, tu asistente de conocimiento corporativo. 
                Tengo acceso a los archivos de ${department}. ¬øQu√© necesitas consultar hoy?</p>
            </div>
        </div>
    </div>
    `;
}
</script> -->
<script src="assets/js/utils.js"></script>
<script>document.addEventListener('DOMContentLoaded', loadSidebar);</script>
</body></html>